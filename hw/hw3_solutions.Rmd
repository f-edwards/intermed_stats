---
title: "Untitled"
author: "Frank Edwards"
date: "3/2/2021"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(broom)

dat<-read_csv("./data/revenue_dat.csv")
```

## Homework

Repeat this process with a new outcome: `violent.yr`. This variable is a measure of the average number of violent index crimes known to police in a county per year. Build a model that helps us explain variation in violent crime across counties and/or over time. 

1. Describe your theory in plain english.

I think that places with higher levels of deep poverty (income less than 200 percent of the poverty line) are likely to have higher levels of violent crime, because structural inequalities are linked with community violence.

2. Describe a linear model that matches your theory (provide equations for the model).

\[y_i \sim N(\mu_i, \sigma^2)\]
\[\mu_i = \beta_0 + \beta_1x_{1i}\]

3. Fit that model using `lm()`

```{r}
### turn violent crime into a rate, crime per 1,000 people per year
### also transform pct_deep_pov to a percentage scale rather than proportion
dat<-dat %>% 
  mutate(violent.pc = violent.yr / pop_tot * 1e3,
         pop_pct_deep_pov = pop_pct_deep_pov * 100)

m0<-lm(violent.pc ~ pop_pct_deep_pov,
       data = dat)
```


4. Interpret the parameter estimates for that model. 

When no one is in deep poverty in a county, the model predicts `r coef(m0)[1]` violent crimes per 1,000 people per year. The model predicts that violent crimes will increase by `r coef(m0)[2]` for a one percent increase in the population in deep poverty. 


5. Visualize this model

```{r}
ggplot(dat,
       aes(y = violent.pc, x = pop_pct_deep_pov)) + 
  geom_point(alpha = 0.5) + 
  geom_abline(intercept = coef(m0)[1], slope = coef(m0)[2])
```

6. Add an appropriate interaction term. Explain your choice.

I'll add an interaction for racial segregation. More segregated places likely have higher violent crime as a function of exclusion and structural violence. Those levels are likely to be higher when poverty is high.

```{r}
m1<-lm(violent.pc ~ pop_pct_deep_pov * dissim_bw,
       data = dat)
```

7. Visualize this new model with an interaction

We'll set scenarios for low, median, and high segregation along the range of observed deep poverty percent. I create a sequence of poverty values from 0 to 30, then repeat this sequence for the 10th, 50th, and 90th percentile of Black / white segregation to simulate.

```{r}
fake_data<-tibble(pop_pct_deep_pov = rep(seq(1, 30, by = 1),3),
                  dissim_bw = c(rep(quantile(dat$dissim_bw, 0.1, na.rm=T), 30),
                                rep(median(dat$dissim_bw, na.rm=T), 30),
                                rep(quantile(dat$dissim_bw, 0.9, na.rm=T), 30)))

fake_data<-fake_data %>% 
  mutate(yhat = predict(m1, newdata = fake_data))

ggplot(dat,
       aes(x = pop_pct_deep_pov, y = violent.pc)) + 
  geom_point(alpha = 0.3) + 
  geom_line(data = fake_data, aes(x = pop_pct_deep_pov, y = yhat, color = factor(dissim_bw)))
```


8. Interpret the model 

The model shows that we expect to see higher levels of violent crime when both segregation and poverty are high, compared to places where segregation and poverty are low.